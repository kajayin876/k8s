<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.7.24 (476601)"/><meta name="author" content="k1mcu740"/><meta name="created" content="2022-10-01 13:59:01 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml"/><meta name="updated" content="2024-12-06 18:04:53 +0000"/><title>kubernetes dashboard 安装</title></head><body><div><br clear="none"/></div><div><span style="font-size: 16pt;">1.设置kubernetes 账号</span></div><div><span style="font-size: 16pt;"><br clear="none"/></span></div><div>apiVersion: v1</div><div>kind: ServiceAccount</div><div>metadata:</div><div>  name: admin-user</div><div>  namespace: kube-system</div><div>---</div><div>apiVersion: rbac.authorization.k8s.io/v1</div><div>kind: ClusterRoleBinding</div><div>metadata:</div><div>  name: admin-user</div><div>roleRef:</div><div>  apiGroup: rbac.authorization.k8s.io</div><div>  kind: ClusterRole</div><div>  name: cluster-admin</div><div>subjects:</div><div>- kind: ServiceAccount</div><div>  name: admin-user</div><div>  namespace: kube-system</div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><span style="font-size: 24pt;">1.1 查询用户登录token</span></div><div>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')</div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><span style="font-size: 24pt;">1.2 dashboard 安装</span></div><div><br clear="none"/></div><div># Copyright 2017 The Kubernetes Authors.</div><div>#</div><div># Licensed under the Apache License, Version 2.0 (the "License");</div><div># you may not use this file except in compliance with the License.</div><div># You may obtain a copy of the License at</div><div>#</div><div>#     <a shape="rect" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></div><div>#</div><div># Unless required by applicable law or agreed to in writing, software</div><div># distributed under the License is distributed on an "AS IS" BASIS,</div><div># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div># See the License for the specific language governing permissions and</div><div># limitations under the License.</div><div><br clear="none"/></div><div>apiVersion: v1</div><div>kind: Namespace</div><div>metadata:</div><div>  name: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: v1</div><div>kind: ServiceAccount</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: Service</div><div>apiVersion: v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div>spec:</div><div>  ports:</div><div>    - port: 443</div><div>      targetPort: 8443</div><div>  selector:</div><div>    k8s-app: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: v1</div><div>kind: Secret</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard-certs</div><div>  namespace: kubernetes-dashboard</div><div>type: Opaque</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: v1</div><div>kind: Secret</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard-csrf</div><div>  namespace: kubernetes-dashboard</div><div>type: Opaque</div><div>data:</div><div>  csrf: ""</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: v1</div><div>kind: Secret</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard-key-holder</div><div>  namespace: kubernetes-dashboard</div><div>type: Opaque</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: ConfigMap</div><div>apiVersion: v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard-settings</div><div>  namespace: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: Role</div><div>apiVersion: rbac.authorization.k8s.io/v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div>rules:</div><div>  # Allow Dashboard to get, update and delete Dashboard exclusive secrets.</div><div>  - apiGroups: [""]</div><div>    resources: ["secrets"]</div><div>    resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]</div><div>    verbs: ["get", "update", "delete"]</div><div>    # Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.</div><div>  - apiGroups: [""]</div><div>    resources: ["configmaps"]</div><div>    resourceNames: ["kubernetes-dashboard-settings"]</div><div>    verbs: ["get", "update"]</div><div>    # Allow Dashboard to get metrics.</div><div>  - apiGroups: [""]</div><div>    resources: ["services"]</div><div>    resourceNames: ["heapster", "dashboard-metrics-scraper"]</div><div>    verbs: ["proxy"]</div><div>  - apiGroups: [""]</div><div>    resources: ["services/proxy"]</div><div>    resourceNames: ["heapster", "http:heapster:", "https:heapster:", "dashboard-metrics-scraper", "http:dashboard-metrics-scraper"]</div><div>    verbs: ["get"]</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: ClusterRole</div><div>apiVersion: rbac.authorization.k8s.io/v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>rules:</div><div>  # Allow Metrics Scraper to get metrics from the Metrics server</div><div>  - apiGroups: ["metrics.k8s.io"]</div><div>    resources: ["pods", "nodes"]</div><div>    verbs: ["get", "list", "watch"]</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: rbac.authorization.k8s.io/v1</div><div>kind: RoleBinding</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div>roleRef:</div><div>  apiGroup: rbac.authorization.k8s.io</div><div>  kind: Role</div><div>  name: kubernetes-dashboard</div><div>subjects:</div><div>  - kind: ServiceAccount</div><div>    name: kubernetes-dashboard</div><div>    namespace: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>apiVersion: rbac.authorization.k8s.io/v1</div><div>kind: ClusterRoleBinding</div><div>metadata:</div><div>  name: kubernetes-dashboard</div><div>roleRef:</div><div>  apiGroup: rbac.authorization.k8s.io</div><div>  kind: ClusterRole</div><div>  name: kubernetes-dashboard</div><div>subjects:</div><div>  - kind: ServiceAccount</div><div>    name: kubernetes-dashboard</div><div>    namespace: kubernetes-dashboard</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: Deployment</div><div>apiVersion: apps/v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: kubernetes-dashboard</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div>spec:</div><div>  replicas: 1</div><div>  revisionHistoryLimit: 10</div><div>  selector:</div><div>    matchLabels:</div><div>      k8s-app: kubernetes-dashboard</div><div>  template:</div><div>    metadata:</div><div>      labels:</div><div>        k8s-app: kubernetes-dashboard</div><div>    spec:</div><div>      securityContext:</div><div>        seccompProfile:</div><div>          type: RuntimeDefault</div><div>      containers:</div><div>        - name: kubernetes-dashboard</div><div>          image: kubernetesui/dashboard:v2.5.0</div><div>          imagePullPolicy: Always</div><div>          ports:</div><div>            - containerPort: 8443</div><div>              protocol: TCP</div><div>          args:</div><div>            - --auto-generate-certificates</div><div>            - --namespace=kubernetes-dashboard</div><div>            # Uncomment the following line to manually specify Kubernetes API server Host</div><div>            # If not specified, Dashboard will attempt to auto discover the API server and connect</div><div>            # to it. Uncomment only if the default does not work.</div><div>            # - --apiserver-host=<a shape="rect" href="http://my-address:port/">http://my-address:port</a></div><div>          volumeMounts:</div><div>            - name: kubernetes-dashboard-certs</div><div>              mountPath: /certs</div><div>              # Create on-disk volume to store exec logs</div><div>            - mountPath: /tmp</div><div>              name: tmp-volume</div><div>          livenessProbe:</div><div>            httpGet:</div><div>              scheme: HTTPS</div><div>              path: /</div><div>              port: 8443</div><div>            initialDelaySeconds: 30</div><div>            timeoutSeconds: 30</div><div>          securityContext:</div><div>            allowPrivilegeEscalation: false</div><div>            readOnlyRootFilesystem: true</div><div>            runAsUser: 1001</div><div>            runAsGroup: 2001</div><div>      volumes:</div><div>        - name: kubernetes-dashboard-certs</div><div>          secret:</div><div>            secretName: kubernetes-dashboard-certs</div><div>        - name: tmp-volume</div><div>          emptyDir: {}</div><div>      serviceAccountName: kubernetes-dashboard</div><div>      nodeSelector:</div><div>        "kubernetes.io/os": linux</div><div>      # Comment the following tolerations if Dashboard must not be deployed on master</div><div>      tolerations:</div><div>        - key: node-role.kubernetes.io/master</div><div>          effect: NoSchedule</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: Service</div><div>apiVersion: v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: dashboard-metrics-scraper</div><div>  name: dashboard-metrics-scraper</div><div>  namespace: kubernetes-dashboard</div><div>spec:</div><div>  ports:</div><div>    - port: 8000</div><div>      targetPort: 8000</div><div>  selector:</div><div>    k8s-app: dashboard-metrics-scraper</div><div><br clear="none"/></div><div>---</div><div><br clear="none"/></div><div>kind: Deployment</div><div>apiVersion: apps/v1</div><div>metadata:</div><div>  labels:</div><div>    k8s-app: dashboard-metrics-scraper</div><div>  name: dashboard-metrics-scraper</div><div>  namespace: kubernetes-dashboard</div><div>spec:</div><div>  replicas: 1</div><div>  revisionHistoryLimit: 10</div><div>  selector:</div><div>    matchLabels:</div><div>      k8s-app: dashboard-metrics-scraper</div><div>  template:</div><div>    metadata:</div><div>      labels:</div><div>        k8s-app: dashboard-metrics-scraper</div><div>    spec:</div><div>      securityContext:</div><div>        seccompProfile:</div><div>          type: RuntimeDefault</div><div>      containers:</div><div>        - name: dashboard-metrics-scraper</div><div>          image: kubernetesui/metrics-scraper:v1.0.7</div><div>          ports:</div><div>            - containerPort: 8000</div><div>              protocol: TCP</div><div>          livenessProbe:</div><div>            httpGet:</div><div>              scheme: HTTP</div><div>              path: /</div><div>              port: 8000</div><div>            initialDelaySeconds: 30</div><div>            timeoutSeconds: 30</div><div>          volumeMounts:</div><div>          - mountPath: /tmp</div><div>            name: tmp-volume</div><div>          securityContext:</div><div>            allowPrivilegeEscalation: false</div><div>            readOnlyRootFilesystem: true</div><div>            runAsUser: 1001</div><div>            runAsGroup: 2001</div><div>      serviceAccountName: kubernetes-dashboard</div><div>      nodeSelector:</div><div>        "kubernetes.io/os": linux</div><div>      # Comment the following tolerations if Dashboard must not be deployed on master</div><div>      tolerations:</div><div>        - key: node-role.kubernetes.io/master</div><div>          effect: NoSchedule</div><div>      volumes:</div><div>        - name: tmp-volume</div><div>          emptyDir: {}</div><div><br clear="none"/></div><div><span style="font-size: 24pt;">1.3 dashboard 暴露dashboard</span></div><div>kind: Service</div><div>apiVersion: v1</div><div>metadata:</div><div>  name: kubernetes-dashboard</div><div>  namespace: kubernetes-dashboard</div><div>  labels:</div><div>    </div><div>    k8s-app: kubernetes-dashboard</div><div>    kubernetes.io/cluster-service: 'true'</div><div><br clear="none"/></div><div>spec:</div><div>  ports:</div><div>    - protocol: TCP</div><div>      port: 80</div><div>      targetPort: 8443</div><div>      nodePort: 32079</div><div>  selector:</div><div>    k8s-app: kubernetes-dashboard</div><div>  type: NodePort</div><div>  sessionAffinity: None</div><div>  externalTrafficPolicy: Cluster</div><div>  ipFamilies:</div><div>    - IPv4</div><div>  ipFamilyPolicy: SingleStack</div><div>  internalTrafficPolicy: Cluster</div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div></body></html>